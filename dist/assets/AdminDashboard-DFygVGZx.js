import{j as e,d as C,r as n,V as y,c as E,O as V,l as L}from"./vendor-C22lMxs3.js";import{a as O}from"./index-CDfupFrp.js";import{L as M,B as P}from"./Button-C2gHDiQh.js";import{v as I,d as q,u as R,b as Q,a as K,c as $,e as B}from"./userApi-C5VETMzr.js";function T({activeTab:a,setActiveTab:l,fetchOrders:u,fetchUsers:t}){return e.jsxs("nav",{className:"bg-white shadow rounded mb-6 p-4 flex gap-4",children:[e.jsx("button",{className:`px-4 py-2 rounded ${a==="orders"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>{l("orders"),u()},children:"Manage Orders"}),e.jsx("button",{className:`px-4 py-2 rounded ${a==="users"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>{l("users"),t()},children:"Manage Users"}),e.jsx("button",{className:`px-4 py-2 rounded ${a==="stationery"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>l("stationery"),children:"Manage Stationery"})]})}function _({files:a}){if(!a||a.length===0)return e.jsx("div",{className:"text-gray-500",children:"No files uploaded"});const l=async u=>{try{const p=(await C.get(`/api/get-signed-url?filename=${encodeURIComponent(u)}`)).data.url;window.open(p,"_blank")}catch(t){console.error("Failed to fetch signed URL",t),alert("⚠️ File not found or expired.")}};return e.jsx("div",{className:"flex flex-col items-start space-y-1 p-2",children:a.map((u,t)=>e.jsxs("button",{onClick:()=>l(u.name),className:"text-red-600 underline flex items-center space-x-1 hover:text-red-800",children:[e.jsx("span",{role:"img","aria-label":"file",children:"📄"}),e.jsx("span",{children:u.name})]},t))})}function J({orders:a,loading:l,handleStatusChange:u}){return l?e.jsx("div",{className:"text-center p-4",children:"Loading orders..."}):!Array.isArray(a)||a.length===0?e.jsx("div",{className:"text-center",children:"No orders found."}):e.jsx("div",{className:"rounded-xl border border-gray-300 shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-800 whitespace-nowrap",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Order No"}),e.jsx("th",{className:"px-3 py-2 border",children:"User Email"}),e.jsx("th",{className:"px-3 py-2 border",children:"Files"}),e.jsx("th",{className:"px-3 py-2 border",children:"Pages"}),e.jsx("th",{className:"px-3 py-2 border",children:"Options"}),e.jsx("th",{className:"px-3 py-2 border",children:"Total Price"}),e.jsx("th",{className:"px-3 py-2 border",children:"Status"}),e.jsx("th",{className:"px-3 py-2 border",children:"Date"})]})}),e.jsx("tbody",{children:a.map((t,p)=>{var c,d;return e.jsxs("tr",{className:p%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-3 py-1 border text-center font-semibold",children:t.orderNumber}),e.jsx("td",{className:"px-3 py-1 border text-center",children:t.userEmail}),e.jsx("td",{className:"px-3 py-1 border text-center",children:e.jsx(_,{files:Array.isArray(t.attachedFiles)?t.attachedFiles:[]})}),e.jsx("td",{className:"px-3 py-1 border text-center font-mono",children:t.totalPages??"-"}),e.jsxs("td",{className:"px-3 py-1 border text-center",children:[(c=t.printType)==null?void 0:c.toUpperCase()," |"," ",(d=t.sideOption)==null?void 0:d.toUpperCase()," ",t.spiralBinding?"| Spiral":""]}),e.jsxs("td",{className:"px-3 py-1 border text-right font-medium",children:["₹",t.totalCost]}),e.jsx("td",{className:"px-3 py-1 border text-center",children:e.jsxs("select",{value:t.status,onChange:h=>u(t.id,h.target.value),className:"border rounded px-2 py-1 text-sm shadow-sm bg-white",children:[e.jsx("option",{value:"new",children:"🟡 New"}),e.jsx("option",{value:"in process",children:"🟠 In Process"}),e.jsx("option",{value:"ready to deliver",children:"🟢 Ready"})]})}),e.jsx("td",{className:"px-3 py-1 border text-center",children:new Date(t.createdAt).toLocaleString()})]},t.id)})})]})})}function z({users:a,loading:l,handleRoleChange:u,handleBlockUser:t,handleUnblockUser:p,handleDeleteUser:c,handleVerifyMobile:d,setEditUser:h}){return l?e.jsx("div",{className:"text-center p-4",children:"Loading users..."}):a.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border shadow text-sm sm:text-base",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Email"}),e.jsx("th",{className:"px-3 py-2 border",children:"Role"}),e.jsx("th",{className:"px-3 py-2 border",children:"First Name"}),e.jsx("th",{className:"px-3 py-2 border",children:"Last Name"}),e.jsx("th",{className:"px-3 py-2 border",children:"Mobile"}),e.jsx("th",{className:"px-3 py-2 border",children:"Verified"}),e.jsx("th",{className:"px-3 py-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(i=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"px-3 py-2 border break-words",children:i.email}),e.jsx("td",{className:"px-3 py-2 border",children:i.role}),e.jsx("td",{className:"px-3 py-2 border",children:i.firstName}),e.jsx("td",{className:"px-3 py-2 border",children:i.lastName}),e.jsx("td",{className:"px-3 py-2 border",children:i.mobileNumber}),e.jsx("td",{className:"px-3 py-2 border",children:i.mobileVerified?"✅":"❌"}),e.jsxs("td",{className:"px-3 py-2 border flex flex-wrap justify-center gap-1",children:[e.jsx("button",{onClick:()=>h(i),className:"text-blue-500 underline",children:"Edit"}),e.jsx("button",{onClick:()=>u(i.email,i.role==="admin"?"user":"admin"),className:"text-yellow-600 underline",children:"Toggle Role"}),e.jsx("button",{onClick:()=>i.blocked?p(i.email):t(i.email),className:"text-purple-600 underline",children:i.blocked?"Unblock":"Block"}),e.jsx("button",{onClick:()=>d(i.email),className:"text-green-600 underline",children:"Verify"}),e.jsx("button",{onClick:()=>c(i.email),className:"text-red-600 underline",children:"Delete"})]})]},i.email))})]})}):e.jsx("div",{className:"text-center",children:"No users found."})}const G=()=>{const[a,l]=n.useState(""),[u,t]=n.useState(""),[p,c]=n.useState(""),[d,h]=n.useState(""),[i,w]=n.useState(""),[s,x]=n.useState(""),[m,v]=n.useState([{color:"",sku:"",imageFile:null}]),[j,S]=n.useState(!1),F=()=>{v(o=>[...o,{color:"",sku:"",imageFile:null}])},U=(o,g,N)=>{const r=[...m];r[o][g]=N,v(r)},D=o=>{v(g=>g.filter((N,r)=>r!==o))},k=async o=>{if(o.preventDefault(),!a||!p||!s){y.error("Name, Price & SKU are required.");return}S(!0);try{const g=parseFloat(d)||0,N=parseInt(i,10)||0,r=new FormData;r.append("name",a),r.append("description",u),r.append("price",p),r.append("discount",g),r.append("quantity",N),r.append("sku",s),r.append("variants",JSON.stringify(m.map(f=>({color:f.color,sku:f.sku})))),m.forEach(f=>{f.imageFile&&r.append("variantImages",f.imageFile)});const b=await C.post("/api/admin/stationery/add",r,{headers:{"Content-Type":"multipart/form-data"}});y.success(b.data.message||"Product uploaded successfully!"),l(""),t(""),c(""),h(""),w(""),x(""),v([{color:"",sku:"",imageFile:null}])}catch(g){console.error(g),y.error("Failed to upload product. Please try again.")}finally{S(!1)}};return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"➕ Add Stationery Product"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name *",className:"w-full p-2 border rounded",value:a,onChange:o=>l(o.target.value)}),e.jsx("textarea",{placeholder:"Short Description",className:"w-full p-2 border rounded",value:u,onChange:o=>t(o.target.value)}),e.jsx("input",{type:"text",placeholder:"SKU *",className:"w-full p-2 border rounded",value:s,onChange:o=>x(o.target.value)}),e.jsx("input",{type:"number",placeholder:"Price (₹) *",className:"w-full p-2 border rounded",value:p,onChange:o=>c(o.target.value)}),e.jsx("input",{type:"number",placeholder:"Discount (%)",className:"w-full p-2 border rounded",value:d,onChange:o=>h(o.target.value)}),e.jsx("input",{type:"number",placeholder:"Quantity *",className:"w-full p-2 border rounded",value:i,onChange:o=>w(o.target.value),min:0}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variants"}),m.map((o,g)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Color",className:"border p-1 rounded flex-1",value:o.color,onChange:N=>U(g,"color",N.target.value)}),e.jsx("input",{type:"text",placeholder:"Variant SKU",className:"border p-1 rounded flex-1",value:o.sku,onChange:N=>U(g,"sku",N.target.value)}),e.jsx("input",{type:"file",accept:"image/*",onChange:N=>U(g,"imageFile",N.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>D(g),className:"text-red-600",children:"✕"})]},g)),e.jsx("button",{type:"button",onClick:F,className:"text-blue-600",children:"+ Add Variant"})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",disabled:j,children:j?"Uploading...":"Upload Product"})]})]})},H=({product:a,onClose:l,onUpdate:u})=>{const[t,p]=n.useState(""),[c,d]=n.useState(""),[h,i]=n.useState(""),[w,s]=n.useState(""),[x,m]=n.useState(""),[v,j]=n.useState(0),[S,F]=n.useState([]),[U,D]=n.useState([]),[k,o]=n.useState(!1);n.useEffect(()=>{a&&(p(a.name||""),d(a.description||""),i(a.price||""),s(a.discount||""),m(a.sku||""),j(a.quantity||0),F(Array.isArray(a.images)?a.images:[]),D([]))},[a]);const g=r=>{F(b=>b.filter((f,A)=>A!==r))},N=async r=>{if(r.preventDefault(),!t||!h||!x){y.error("Name, price, and SKU are required");return}const b=new FormData;b.append("name",t),b.append("description",c),b.append("price",h),b.append("discount",w),b.append("sku",x),b.append("quantity",v),b.append("existing",JSON.stringify(S)),U.forEach(f=>b.append("images",f));try{o(!0);const f=await C.put(`/api/admin/stationery/update/${a.id}`,b,{headers:{"Content-Type":"multipart/form-data"}});y.success(f.data.message||"Product updated"),l(),u()}catch(f){console.error(f),y.error("Failed to update product")}finally{o(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-xl",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:t,onChange:r=>p(r.target.value),placeholder:"Product name"}),e.jsx("textarea",{className:"w-full border p-2 rounded",value:c,onChange:r=>d(r.target.value),placeholder:"Description"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:x,onChange:r=>m(r.target.value),placeholder:"SKU"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:h,onChange:r=>i(r.target.value),placeholder:"Price"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:w,onChange:r=>s(r.target.value),placeholder:"Discount (%)"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:v,onChange:r=>j(parseInt(r.target.value,10)),placeholder:"Quantity",min:"0"}),S.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:S.map((r,b)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:"existing",className:"w-24 h-24 object-cover rounded"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 bg-red-600 text-white text-xs px-1 rounded",onClick:()=>g(b),children:"✕"})]},b))}),e.jsx("input",{type:"file",className:"w-full border p-2 rounded",onChange:r=>D(Array.from(r.target.files)),multiple:!0,accept:"image/*"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:k,children:k?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",className:"px-4 py-2 border rounded",onClick:l,children:"Cancel"})]})]})]})}):null};function W(){const[a,l]=n.useState([]),[u,t]=n.useState(!1),[p,c]=n.useState(null),d=async()=>{t(!0);try{const s=await C.get("/api/stationery/products");l(Array.isArray(s.data.products)?s.data.products:[])}catch(s){console.error("❌ Failed to load products:",s),y.error("Failed to load stationery.")}finally{t(!1)}};n.useEffect(()=>{d()},[]);const h=async s=>{if(window.confirm("Delete this product?"))try{await C.delete(`/api/admin/stationery/delete/${s}`),y.success("Product deleted"),d()}catch(x){console.error("❌ Failed to delete product:",x),y.error("Delete failed")}},i=async(s,x)=>{try{await C.put(`/api/admin/stationery/product/${s}/sku`,{sku:x}),d(),y.success("SKU updated")}catch{y.error("SKU update failed")}},w=async(s,x)=>{const m=parseInt(x,10);if(!(isNaN(m)||m<0))try{await C.put(`/api/admin/stationery/product/${s}/quantity`,{quantity:m}),d(),y.success("Quantity updated")}catch{y.error("Quantity update failed")}};return e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"📦 All Stationery Products"}),u?e.jsx("div",{children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto bg-white shadow rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"#"}),e.jsx("th",{className:"px-4 py-2 border",children:"Image"}),e.jsx("th",{className:"px-4 py-2 border",children:"Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 border",children:"Price"}),e.jsx("th",{className:"px-4 py-2 border",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2 border",children:"Variants"}),e.jsx("th",{className:"px-4 py-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:a.map((s,x)=>{const m=Array.isArray(s.images)?s.images:[],v=Array.isArray(s.variants)?s.variants:[];return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"px-4 py-2 border",children:x+1}),e.jsx("td",{className:"px-4 py-2 border",children:m.length>0?e.jsx("img",{src:m[0],alt:s.name,className:"w-16 h-16 object-cover mx-auto"}):"No image"}),e.jsx("td",{className:"px-4 py-2 border",children:s.name}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("input",{type:"text",className:"w-full p-1 border rounded text-sm",value:s.sku||"",onChange:j=>i(s.id,j.target.value)})}),e.jsxs("td",{className:"px-4 py-2 border",children:["₹",s.price.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("input",{type:"number",min:"0",className:"w-full p-1 border rounded text-sm",value:s.quantity,onChange:j=>w(s.id,j.target.value)})}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("div",{className:"flex justify-center space-x-2",children:v.map(j=>e.jsx("img",{src:j.imageUrl,title:j.color,className:"w-6 h-6 rounded-full border border-gray-300 hover:border-blue-500 cursor-pointer"},j.sku))})}),e.jsxs("td",{className:"px-4 py-2 border space-x-2",children:[e.jsx("button",{onClick:()=>c(s),className:"bg-gray-500 text-white px-2 py-1 rounded text-xs",children:"Edit"}),e.jsx("button",{onClick:()=>h(s.id),className:"bg-red-500 text-white px-2 py-1 rounded text-xs",children:"Delete"})]})]},s.id)})})]})}),p&&e.jsx(H,{product:p,onClose:()=>c(null),onUpdate:()=>{c(null),d()}})]})}function X({editUser:a,setEditUser:l,handleEditUser:u,saving:t}){if(!a)return null;const p=c=>{const d=c.target.checked;l(h=>({...h,mobileVerified:d?1:0}))};return e.jsxs("div",{className:"fixed top-10 right-10 bg-white p-4 shadow rounded-lg w-96 space-y-2",children:[e.jsx("h2",{className:"font-bold text-lg mb-2",children:"Edit User"}),e.jsx("input",{type:"text",value:a.email||"",disabled:!0,className:"w-full border p-2 rounded bg-gray-100",placeholder:"Email (readonly)"}),e.jsx("input",{type:"text",value:a.firstName||"",onChange:c=>l(d=>({...d,firstName:c.target.value})),placeholder:"First Name",className:"w-full border p-2 rounded"}),e.jsx("input",{type:"text",value:a.lastName||"",onChange:c=>l(d=>({...d,lastName:c.target.value})),placeholder:"Last Name",className:"w-full border p-2 rounded"}),e.jsx("input",{type:"text",value:a.mobileNumber||"",onChange:c=>l(d=>({...d,mobileNumber:c.target.value})),placeholder:"Mobile Number",className:"w-full border p-2 rounded"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.mobileVerified===1,onChange:p}),e.jsx("label",{children:"Mobile Verified"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:u,disabled:t,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50",children:t?"Saving...":"Save"}),e.jsx("button",{onClick:()=>l(null),className:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded",children:"Cancel"})]})]})}const Y=async()=>(await C.get("/api/get-orders")).data,Z=async(a,l)=>{await C.post("/api/update-order-status",{orderId:a,newStatus:l})};function re(){const a=E(),[l,u]=n.useState(!0),[t,p]=n.useState("orders"),[c,d]=n.useState([]),[h,i]=n.useState([]),[w,s]=n.useState(!1),[x,m]=n.useState(null),[v,j]=n.useState(!1);n.useEffect(()=>{(async()=>{try{await S()}finally{u(!1)}})()},[]);const S=async()=>{s(!0);try{const{orders:k}=await Y();d(k)}catch{y.error("Failed to load orders")}finally{s(!1)}},F=async()=>{s(!0);try{const{users:k}=await B();i(k)}catch{y.error("Failed to load users")}finally{s(!1)}},U=async()=>{await L(O),a("/login")},D=()=>a("/userdashboard");return l?e.jsx("div",{className:"text-center mt-10",children:"Checking login…"}):e.jsxs(M,{title:"Admin Dashboard",children:[e.jsx(V,{}),e.jsxs("div",{className:"flex justify-end gap-2 mb-6",children:[e.jsx(P,{variant:"secondary",onClick:D,children:"Back to User View"}),e.jsx(P,{variant:"danger",onClick:U,children:"Logout"})]}),e.jsx(T,{activeTab:t,setActiveTab:p,fetchOrders:S,fetchUsers:F}),e.jsxs("div",{className:"mt-6 p-6 bg-white rounded shadow overflow-auto min-h-[60vh]",children:[t==="orders"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Orders"}),e.jsx(J,{orders:c,loading:w,handleStatusChange:Z})]}),t==="users"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Users"}),e.jsx(z,{users:h,loading:w,handleRoleChange:K,handleBlockUser:Q,handleUnblockUser:R,handleDeleteUser:q,handleVerifyMobile:I,setEditUser:m}),x&&e.jsx(X,{editUser:x,setEditUser:m,handleEditUser:$,saving:v})]}),t==="stationery"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Stationery"}),e.jsx(G,{}),e.jsx(W,{})]})]})]})}export{re as default};
